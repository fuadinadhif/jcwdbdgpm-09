generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum RoleType {
  CUSTOMER
  EVENT_ORGANIZER
}

enum StatusOrder {
  PENDING
  REJECTED
  CANCELLED
  EXPIRED
  DONE
}

model User {
  id       String   @id @default(uuid())
  name     String   @db.VarChar(255)
  username String   @unique @db.VarChar(100)
  email    String   @unique @db.VarChar(100)
  password String   @db.VarChar(500)
  bio      String?  @db.VarChar(500)
  role     RoleType @default(CUSTOMER)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  wallets Wallet?
  orders  Order[]
  events  Event[]

  @@map("users")
}

model Wallet {
  id      String @id @default(uuid())
  userId  String @unique
  balance Float

  users User @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@map("wallets")
}

model Event {
  id               String @id @default(uuid())
  eventOrganizerId String
  name             String @unique @db.VarChar(255)
  price            Float
  totalSeats       Int
  availableSeats   Int

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  eventOrganizer User @relation(fields: [eventOrganizerId], references: [id])

  orders      Order[]
  eventImages EventImage[]

  @@map("events")
}

model EventImage {
  id      String @id @default(uuid())
  eventId String
  url     String

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  event Event @relation(fields: [eventId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@map("event_images")
}

model Image {
  id  String @id @default(uuid())
  url String

  @@map("images")
}

model Order {
  id          String      @id @default(uuid())
  customerId  String
  eventId     String
  quantity    Int
  totalAmount Float
  status      StatusOrder @default(PENDING)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  customers User  @relation(fields: [customerId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  events    Event @relation(fields: [eventId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@map("orders")
}
